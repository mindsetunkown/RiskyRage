name: Build Risky Rage

on:
  push:
    branches: [main]
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2️⃣ Set up Java 25
      - name: Set up Java 25
        uses: actions/setup-java@v3
        with:
          java-version: '25'
          distribution: 'temurin'

      # 3️⃣ Prepare build folder
      - name: Prepare build folder
        run: |
          mkdir -p build
          echo "Build folder ready."

      # 4️⃣ Detect Paper API JAR automatically
      - name: Detect Paper API JAR
        id: detect-paper
        run: |
          PAPER_JAR=$(find libs -name "paper-api*.jar" | head -n 1)
          if [ -z "$PAPER_JAR" ]; then
            echo "ERROR: No Paper API JAR found in libs!"
            exit 1
          fi
          echo "Found Paper API: $PAPER_JAR"
          echo "PAPER_JAR=$PAPER_JAR" >> $GITHUB_ENV

      # 5️⃣ Compile all Java files using detected Paper API
      - name: Compile plugin
        run: |
          echo "Compiling all Java files..."
          javac -cp "$PAPER_JAR:libs/*" -d build $(find . -name "*.java")
          echo "Compilation finished."

      # 6️⃣ Package plugin JAR
      - name: Package plugin JAR
        run: |
          cd build
          jar cf ../RiskyRage-1.0.jar .
          cd ..
          echo "JAR packaged successfully."

      # 7️⃣ Upload artifact
      - name: Upload plugin artifact
        uses: actions/upload-artifact@v3
        with:
          name: RiskyRage-JAR
          path: RiskyRage-1.0.jar
